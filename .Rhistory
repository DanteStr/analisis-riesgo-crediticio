geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_classic() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 2500, 300),
limits = c(0, 1900)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 4)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ sexo, scales = "free")
breaks = seq(0, 1800, 300) +
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_classic() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 300)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 4)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ sexo, scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_classic() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 300)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 4)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ sexo, scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 300)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 4)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ sexo, scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 300),
limits =  c(0, 1900)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 4)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ sexo, scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
limits =  c(0, 1900)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 4)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ sexo, scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
limits =  c(0, 1900)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 5)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ sexo, scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
limits =  c(0, 1000)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 5)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ sexo, scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
limits =  c(0, 800)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 5)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ sexo, scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
limits =  c(0, 800)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 5)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ ., scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 5)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ ., scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
limits =  c(0, 1200)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 5)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ ., scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
limits =  c(0, 1300)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 5)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ ., scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
limits =  c(0, 1900)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 5)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ ., scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
limits =  c(0, 1900)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 5)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ ., scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
limits =  c(0, 1900)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 5)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(. ~ morosidad, scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
limits =  c(0, 1900)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 5)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4")) +
facet_grid(morosidad ~ ., scales = "free")
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "none") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
limits =  c(0, 1900)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 5)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4"))
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "bottom") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
limits =  c(0, 1900)) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 5)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4"))
df |> ggplot(aes(x = antiguedad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de antiguedad según la morosidad",
x = "Antiguedad (años)",
y = "") +
theme_bw() +
theme(legend.position = "bottom") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 70, 5)) +
coord_cartesian(ylim = c(0,1800)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4"))
View(df)
colnames(df)
df |> ggplot(aes(x = edad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de edad según la morosidad",
x = "Edad (años)",
y = "") +
theme_bw() +
theme(legend.position = "bottom") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 90, 5)) +
coord_cartesian(ylim = c(0,1800)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4"))
df |> ggplot(aes(x = edad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de edad según la morosidad",
x = "Edad (años)",
y = "") +
theme_bw() +
theme(legend.position = "bottom") +
scale_y_continuous(expand = c(0,0),
) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 90, 5)) +
coord_cartesian(ylim = c(0,1800)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4"))
df |> ggplot(aes(x = edad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de edad según la morosidad",
x = "Edad (años)",
y = "") +
theme_bw() +
theme(legend.position = "bottom") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 400),
) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 90, 5)) +
#coord_cartesian(ylim = c(0,1800)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4"))
df |> ggplot(aes(x = edad,
fill = morosidad)) +
geom_histogram(alpha = 0.5,
bins = 30,
color = "black") +
labs(title = "Histograma de edad según la morosidad",
x = "Edad (años)",
y = "") +
theme_bw() +
theme(legend.position = "bottom") +
scale_y_continuous(expand = c(0,0),
breaks = seq(0, 1800, 200),
) +
scale_x_continuous(expand = c(0,0),
breaks = seq(0, 90, 5)) +
#coord_cartesian(ylim = c(0,1800)) +
scale_fill_manual("Situación",
values = c("darkgreen", "orange4"))
df |> ggplot(aes(x = morosidad,
y = edad,
fill = morosidad)) +
stat_summary(geom = "bar", fun = mean) +
theme_bw()  +
labs(title = "Edad promedio según la Morosidad",
x = "Morosidad",
y = "Edad Promedio",
) +
scale_fill_manual(values = c("darkolivegreen3", "firebrick2"),
"Estado") +
theme(legend.position = "bottom")
str(df)
names(df %>% select(where(is.numeric)))
names(df %>% select(where(is.numeric))) |> is.vector()
names(df %>% select(where(is.factor)))
names(df %>% select(where(is.numeric))) -> var_numericas
var_numericas
var_numericas |> length()
target <- "morosidad"
# Variables numéria
vars_numericas <- names(df %>% select(where(is.numeric)))
# Variables categóricas
vars_categoricas <- names(df %>% select(where(is.factor)))
vars_categoricas <- vars_categoricas[vars_categoricas != target]
print(paste("Numéricas a analizar:", paste(vars_numericas, collapse = ", ")))
print(paste("Categóricas a analizar:", paste(vars_categoricas, collapse = ", ")))
plot_categorica <- function(datos, variable, target_var) {
# Convertimos strings a símbolos para ggplot
x_sym <- rlang::sym(variable)
fill_sym <- rlang::sym(target_var)
# Preparamos porcentajes
datos_plot <- datos %>%
group_by(!!x_sym, !!fill_sym) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(!!x_sym) %>%
mutate(prop = n / sum(n))
# Gráfico
ggplot(datos_plot, aes(x = !!x_sym, y = prop, fill = !!fill_sym)) +
geom_col(position = "fill", width = 0.6) +
# Etiqueta solo para los morosos
geom_text(aes(label = ifelse(!!fill_sym == "Moroso",
scales::percent(prop, accuracy = 0.1), "")),
position = position_fill(vjust = 0.5),
color = "white", fontface = "bold", size = 3) +
scale_y_continuous(labels = scales::percent) +
ggthemes::scale_fill_tableau() + # Colores profesionales
labs(
title = paste("Morosidad según:", toupper(variable)),
subtitle = "Proporción de incumplimiento por categoría",
x = NULL, y = "Proporción", fill = "Estado"
) +
theme_minimal() +
theme(legend.position = "top")
}
plot_numerica <- function(datos, variable, target_var) {
x_sym <- rlang::sym(target_var) # En el eje X ponemos Moroso/No Moroso
y_sym <- rlang::sym(variable)   # En el eje Y ponemos la Edad/Antigüedad
ggplot(datos, aes(x = !!x_sym, y = !!y_sym, fill = !!x_sym)) +
# Geom Boxplot dibuja la caja, los bigotes y los outliers
geom_boxplot(alpha = 0.7, outlier.colour = "red", outlier.shape = 1) +
ggthemes::scale_fill_tableau() +
labs(
title = paste("Distribución de:", toupper(variable)),
subtitle = paste("¿Varía la", variable, "entre quienes pagan y quienes no?"),
x = NULL, y = variable
) +
theme_minimal() +
theme(legend.position = "none") # No hace falta leyenda, el eje X lo dice
}
# Generar gráficos categóricos
plots_cat <- purrr::map(vars_categoricas, ~plot_categorica(df, .x, target))
# Generar gráficos numéricos
plots_num <- purrr::map(vars_numericas, ~plot_numerica(df, .x, target))
# --- MOSTRAR LOS RESULTADOS EN EL RMARKDOWN ---
# 1. Sección Numéricas
print("### Análisis de Variables Numéricas")
purrr::walk(plots_num, print)
# 2. Sección Categóricas
print("### Análisis de Variables Categóricas")
purrr::walk(plots_cat, print)
ncols(df)
cols(df)
col(df)
names(df)
