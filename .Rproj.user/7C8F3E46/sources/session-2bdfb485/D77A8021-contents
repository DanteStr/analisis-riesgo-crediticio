---
title: 'Credit Scoring Analysis: Predección y perfilamiento de riesgo de morosidad'
author: "Dante L. Mendoza Stretz"
date: "2026-01-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

**Objetivo:** Ayudar a las entidades financieras a identificar patrones en los clientes que no pagan.

# 1. Resumen ejecutivo

El README debe tener:

    * Título e Imagen: Un gráfico impactante del proyecto al inicio.

    * El Problema: "¿Cómo reducir la cartera vencida del banco?"

    * La Solución: "Analicé 8,471 clientes y detecté que el factor X es el más determinante..."

    * Tecnologías: R, Tidyverse, Haven, Ggplot2.

    * Hallazgos Clave: (Ej: "Los clientes menores de 30 años sin aval tienen un 40% más de riesgo").

# 2. Configuración del entorno

```{r}
rm(list = ls())
graphics.off()
cat("\014")
#setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
#getwd()

options(digits = 3)
options(scipen = 999)

# Paquetes ----------------------------------------------------- 
library(pacman) # Package Manager
p_load(foreign, colourpicker, plotrix, PerformanceAnalytics,
       ggplot2, gganimate, png, plotly, forcats,
       RColorBrewer, maps, mapdata, lubridate, scales,
       esquisse, cowplot, patchwork, dplyr)
```

# 3. Lectura, limpieza y preparación de los datos

Se utiliza la librería **foreing** para leer un archivo $.sav$.

```{r}

library(foreign)
df <- read.spss("../01_data/BBDD_analisisMorosidad.sav", 
                  use.value.labels = TRUE,  
                  to.data.frame = TRUE)
attr(df, "variable.labels") <- NULL

str(df)

```

```{r}
summary(df)
```



# 4. Análisis Exploratorio (EDA)

## 4.1. Variable Objetivo (Target)

```{r}
df |> ggplot(aes(x = morosidad,
                 fill = morosidad)) + 
  geom_bar(color = "black") +
  
  labs(title = "Gráfico de barras para la morosidad",
       subtitle = "Variable target",
       x = NULL,
       y = "Frecuencia") +
  
  scale_y_continuous(expand = c(0,40),
                     breaks = seq(0, 6000, 500)) +
  
  scale_fill_manual(values = c("royalblue2", "sienna1")) +
  
  theme_bw() +
  
  theme(legend.position = "none")
  

```


## 4.2. Análisis Bivariado

### 4.2.1. Selección de variables categóricas y numéricas

```{r}

target <- "morosidad"

# Variables numéria
vars_numericas <- names(df |> select(where(is.numeric)))

# Variables categóricas
vars_categoricas <- names(df |> select(where(is.factor)))
vars_categoricas <- vars_categoricas[vars_categoricas != target]

print(paste("Numéricas a analizar:", paste(vars_numericas, collapse = ", ")))
print(paste("Categóricas a analizar:", paste(vars_categoricas, collapse = ", ")))
```

### 4.2.2. Análisis bivariado de las variables categóricas


#### A. Tipo de renta

```{r}
df |> ggplot(aes(x = tiporenta,
                 fill = morosidad)) +
  
  geom_bar(position = position_dodge()) +
  
  labs(title = "Situación de la Morosidad según el Tipo de Renta",
       subtitle = "Variable target",
       x = "Tipo de renta",
       y = "Frecuencia") +
  theme_classic() +
  
  scale_y_continuous(expand = c(0,0.01)) +
  
  scale_fill_manual(values = c("darkolivegreen3", "firebrick2")) +
  
  theme(legend.position = "bottom")
```


#### B. Sexo

```{r}
df |> ggplot(aes(x = sexo,
                 fill = morosidad)) +
  
  geom_bar(position = position_fill()) +
  
  labs(title = "Situación de la Morosidad según el Sexo",
       subtitle = "Variable target",
       x = "Sexo",
       y = "Proporción") +
  theme_classic() +
  
  scale_y_continuous(expand = c(0,0),
                     labels = scales::percent_format()) +
  
  scale_fill_manual(values = c("darkolivegreen3", "firebrick2")) +
  
  theme(legend.position = "bottom")
```


#### C. Departamento

```{r}
df |> ggplot(aes(x = dpto,
                 fill = morosidad)) +
  
  geom_bar(position = position_fill()) +
  
  labs(title = "Situación de la Morosidad por Departamento",
       subtitle = "Variable target",
       x = NULL,
       y = "") +
  theme_classic() +
  
  scale_y_continuous(expand = c(0,0),
                     labels = scales::percent_format()) +
  
  scale_fill_manual("Situación",
                    values = c("darkolivegreen3", "firebrick2")) +
  
  theme(legend.position = "bottom")
```

### 4.2.3. Análisis bivariado de las variables numéricas

#### A. Antiguedad

```{r}
## Comparación de medias

df |> ggplot(aes(x = morosidad, 
                 y = antiguedad,
                 fill = morosidad)) +
  stat_summary(geom = "bar", fun = mean) + 
  theme_bw()  +
  labs(title = "Antiguedad promedio según la Morosidad",
       x = "Morosidad",
       y = "Antiguedad Promedio",
       ) +
  scale_fill_manual(values = c("darkolivegreen3", "firebrick2"),
                    "Estado") + 
  theme(legend.position = "bottom")

## Histograma

df |> ggplot(aes(x = antiguedad, 
                 fill = morosidad)) +
  
  geom_histogram(alpha = 0.5, 
                 bins = 30,
                 color = "black") +
  
  labs(title = "Histograma de antiguedad según la morosidad",
       x = "Antiguedad (años)",
       y = "") +
  
  theme_bw() +
  
  theme(legend.position = "bottom") +
  
  scale_y_continuous(expand = c(0,0),
                     breaks = seq(0, 1800, 400),
                     ) + 
  scale_x_continuous(expand = c(0,0),
                     breaks = seq(0, 70, 5)) +
  coord_cartesian(ylim = c(0,1800)) +
  scale_fill_manual("Situación",
                    values = c("darkgreen", "orange4"))

```


#### B. Edad

```{r}
## Comparación de medias

df |> ggplot(aes(x = morosidad, 
                 y = edad,
                 fill = morosidad)) +
  stat_summary(geom = "bar", fun = mean) + 
  theme_bw()  +
  labs(title = "Edad promedio según la Morosidad",
       x = "Morosidad",
       y = "Edad Promedio",
       ) +
  scale_fill_manual(values = c("darkolivegreen3", "firebrick2"),
                    "Estado") + 
  theme(legend.position = "bottom")

## Histograma

df |> ggplot(aes(x = edad, 
                 fill = morosidad)) +
  
  geom_histogram(alpha = 0.5, 
                 bins = 30,
                 color = "black") +
  
  labs(title = "Histograma de edad según la morosidad",
       x = "Edad (años)",
       y = "") +
  
  theme_bw() +
  
  theme(legend.position = "bottom") +
  
  scale_y_continuous(expand = c(0,0),
                     breaks = seq(0, 1800, 200),
                     ) + 
  scale_x_continuous(expand = c(0,0),
                     breaks = seq(0, 90, 5)) +
  #coord_cartesian(ylim = c(0,1800)) +
  scale_fill_manual("Situación",
                    values = c("darkgreen", "orange4"))
```


# 5. Modelado predictivo


# 6. Conclusiones y recomendaciones








